<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.axway.parent</groupId>
        <artifactId>parent</artifactId>
        <version>19</version>
    </parent>

    <groupId>com.axway.apiportal</groupId>
    <artifactId>apiportal</artifactId>
    <version>7.5.3-SNAPSHOT</version>
    <packaging>pom</packaging>
    <name>APIPortal</name>
    <description>Axway API Portal.</description>

    <scm>
        <connection>scm:git@dexter.lab.dubl.axway.int:/git/apiportal.git</connection>
        <developerConnection>scm:git@dexter.lab.dubl.axway.int:/git/apiportal.git</developerConnection>
        <url>http://dexter.lab.dubl.axway.int/git/?p=apiportal.git</url>
    </scm>

    <properties>
        <!-- Also used in src/main/php/pkg_apiportal.xml -->
        <product.name.lowercase>apiportal</product.name.lowercase>
        <!-- Used in pom, assembly files and ReleaseNotes -->
        <base.product.joomla.ext>joomla-extension</base.product.joomla.ext>
        <!-- Also used in ReleaseNotes  -->
        <product.tag>${project.artifactId}-${project.version}-${product.build.date}</product.tag>
        <base.product.name>APIPortal</base.product.name>
        <product.build.number>7.5.3000</product.build.number>
        <base.product.manager>apimanager</base.product.manager>
        <rpm.version>7.5.3</rpm.version>
        <!-- Also used in src/main/php/components.com_apiportal/manifest.xml and in the other plugin's xml files  -->
        <product.build.date>2017-09-01</product.build.date>
        <!-- Used in src/main/php/pkg_apiportal.xml and src/main/php/components.com_apiportal/manifest.xml and in the other plugin's xml files -->
        <product.url>http://www.axway.com/en/enterprise-solutions/api-portal</product.url>
        <!-- Also used in GuideToOperations name - version and ReleaseNotes -->
        <guide.version>1.7</guide.version>

        <!-- SonarQube -->
        <sonar.language>php</sonar.language>
        <sonar.sources>src/main/php</sonar.sources>

        <product.src>${project.basedir}/src/main/php</product.src>
        <product.scripts>${project.basedir}/src/main/scripts</product.scripts>
        <product.dest>${project.build.directory}</product.dest>
        <project.assembly.dir>${project.basedir}/src/assembly</project.assembly.dir>
    </properties>

    <build>
        <plugins>
            <plugin>
                <artifactId>maven-assembly-plugin</artifactId>
                <configuration>
                    <appendAssemblyId>false</appendAssemblyId>
                </configuration>
                <executions>
                    <execution>
                        <id>create-com-apiportal</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <finalName>com_${product.name.lowercase}</finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/com-${product.name.lowercase}.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>create-user-regsesid-plugin</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <finalName>plg_user_regsesid</finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/plg-user-regsesid.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>create-user-apiportal-plugin</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <finalName>plg_user_${product.name.lowercase}</finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/plg-user-apiportal.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>create-system-apiportal-plugin</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <finalName>plg_system_apiportal</finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/plg-system-apiportal.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>create-authentication-apiportal-plugin</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <finalName>plg_authentication_${product.name.lowercase}</finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/plg-authentication-apiportal.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>create-joomla-extension</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <finalName>
                                ${project.artifactId}${project.version}-${base.product.joomla.ext}-BN${product.build.number}
                            </finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/joomla-extension.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>create-apimanager</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <finalName>
                                ${project.artifactId}${project.version}-${base.product.manager}-BN${product.build.number}
                            </finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/apimanager.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>build</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <finalName>${project.artifactId}-${project.version}-BN${product.build.number}</finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/build.xml</descriptor>
                        </configuration>
                    </execution>
                    <execution>
                        <id>copy-post-install-script</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <attach>false</attach>
                            <appendAssemblyId>false</appendAssemblyId>
                            <descriptor>${project.assembly.dir}/post-install.xml</descriptor>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-clean-plugin</artifactId>
                <executions>
                    <execution>
                        <id>clean</id>
                        <phase>initialize</phase>
                        <goals>
                            <goal>clean</goal>
                        </goals>
                        <configuration>
                            <filesets>
                                <fileset>
                                    <directory>${product.dest}/</directory>
                                    <includes>
                                        <include>*</include>
                                    </includes>
                                    <followSymlinks>false</followSymlinks>
                                </fileset>
                            </filesets>
                        </configuration>
                    </execution>
                    <execution>
                        <id>clean-packages</id>
                        <phase>package</phase>
                        <goals>
                            <goal>clean</goal>
                        </goals>
                        <configuration>
                            <excludeDefaultDirectories>true</excludeDefaultDirectories>
                            <filesets>
                                <fileset>
                                    <directory>${product.dest}</directory>
                                    <includes>
                                        <include>com_${product.name.lowercase}.zip</include>
                                        <include>plg_authentication_${product.name.lowercase}.zip</include>
                                        <include>plg_user_${product.name.lowercase}.zip</include>
                                        <include>plg_user_regsesid.zip</include>
                                        <include>plg_system_${product.name.lowercase}.zip</include>
                                        <include>
                                            ${project.artifactId}${project.version}-${base.product.manager}-BN${product.build.number}.zip
                                        </include>
                                    </includes>
                                    <followSymlinks>false</followSymlinks>
                                </fileset>
                                <fileset>
                                    <directory>${product.dest}/archive-tmp</directory>
                                </fileset>
                            </filesets>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>exec-maven-plugin</artifactId>
                <version>1.5.0</version>
                <executions>
                    <execution>
                        <id>rhel-package</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>exec</goal>
                        </goals>
                        <configuration>
                            <executable>/bin/bash</executable>
                            <arguments>
                                <argument>target/make-rhel-package.sh</argument>
                            </arguments>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

    <profiles>
        <profile>
            <!-- Profile for building the RPMs. Conditional as it needs to 
                be executed on appliance only. To activate execute mvn -Dbuild.rpm clean 
                install -->
            <id>RPM-profile</id>
            <activation>
                <property>
                    <name>build.rpm</name>
                </property>
            </activation>
            <dependencies>
                <dependency>
                    <groupId>com.joomlart</groupId>
                    <artifactId>t3-system-plugin</artifactId>
                    <version>2.4.8</version>
                    <type>zip</type>
                </dependency>
                <dependency>
                    <groupId>com.joomlart</groupId>
                    <artifactId>purity-III-template</artifactId>
                    <version>1.1.4</version>
                    <type>zip</type>
                </dependency>
                <dependency>
                    <groupId>net.joomla</groupId>
                    <artifactId>plg_jw_allvideos</artifactId>
                    <version>4.7.0_j1.5-3.x</version>
                    <type>zip</type>
                </dependency>
                <dependency>
                    <groupId>org.joomla</groupId>
                    <artifactId>com_easyblog_pro</artifactId>
                    <version>5.0.40</version>
                    <type>zip</type>
                </dependency>
                <dependency>
                    <groupId>org.joomla</groupId>
                    <artifactId>com_easydiscuss_pro</artifactId>
                    <version>4.0.11</version>
                    <type>zip</type>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <!-- Unpackage the preconfigured joomla tar.gz -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>com.axway.apigateway.thirdparty.joomla</groupId>
                                            <artifactId>joomla-preconfigured</artifactId>
                                            <version>3.6.5</version>
                                            <type>tar.gz</type>
                                            <outputDirectory>target/joomla-preconfigured</outputDirectory>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                            <execution>
                                <id>copy-joomla-upgrade</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>com.axway.apigateway.thirdparty.joomla</groupId>
                                            <artifactId>joomla-update-package</artifactId>
                                            <version>3.6.5</version>
                                            <classifier>package</classifier>
                                            <type>zip</type>
                                            <outputDirectory>target/joomla-upgrade</outputDirectory>
                                        </artifactItem>
                                    </artifactItems>
                                    <overWriteReleases>false</overWriteReleases>
                                    <overWriteSnapshots>true</overWriteSnapshots>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <!-- Replace some strings in  -->
                    <plugin>
                        <groupId>com.google.code.maven-replacer-plugin</groupId>
                        <artifactId>replacer</artifactId>
                        <version>1.5.3</version>
                        <executions>
                            <execution>
                                <id>joomla-configuration</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>target/joomla-preconfigured/configuration.php</file>
                                    <replacements>
                                        <!-- Set the database user to 'joomla' -->
                                        <replacement>
                                            <token>\$user.*</token>
                                            <value>\$user = 'joomla';</value>
                                        </replacement>
                                        <!-- Set the database password to 'changeme' -->
                                        <replacement>
                                            <token>\$password.*</token>
                                            <value>\$password = 'changeme';</value>
                                        </replacement>
                                        <!-- Set the log path -->
                                        <replacement>
                                            <token>\$log_path.*</token>
                                            <value>\$log_path = '/opt/axway/apiportal/htdoc/logs';</value>
                                        </replacement>
                                        <!-- Set the tmp path -->
                                        <replacement>
                                            <token>\$tmp_path.*</token>
                                            <value>\$tmp_path = '/opt/axway/apiportal/htdoc/tmp';</value>
                                        </replacement>
                                        <!-- Set Friendly URLs -->
                                        <replacement>
                                            <token>\$sef = .*</token>
                                            <value>\$sef = '1';</value>
                                        </replacement>
                                        <!-- Set URL rewriting -->
                                        <replacement>
                                            <token>\$sef_rewrite.*</token>
                                            <value>\$sef_rewrite = '1';</value>
                                        </replacement>
                                        <replacement>
                                            <token>\$force_ssl.*</token>
                                            <value>\$force_ssl = '2';</value>
                                        </replacement>

                                        <!-- Set Proxy timeout (in ms) -->
                                        <replacement>
                                            <token>JConfig\s\{</token>
                                            <value>JConfig {&#xA;&#x09; public \$apiPortalProxyTimeout = '30000';
                                            </value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                            <execution>
                                <id>change-version</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>replace</goal>
                                </goals>
                                <configuration>
                                    <file>target/${project.artifactId}-${project.version}/scripts/post-install.sh</file>
                                    <replacements>
                                        <!-- Set the version from pom.xml -->
                                        <replacement>
                                            <token>RELEASE_VERSION=.*</token>
                                            <value>RELEASE_VERSION="${project.version}"</value>
                                        </replacement>
                                    </replacements>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <!-- Add queries for password policy and require password reset -->
                    <plugin>
                        <groupId>com.google.code.echo-maven-plugin</groupId>
                        <artifactId>echo-maven-plugin</artifactId>
                        <version>1.0.0</version>
                        <inherited>false</inherited>
                        <executions>
                            <execution>
                                <id>append-require-reset-pass</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>echo</goal>
                                </goals>
                                <configuration>
                                    <message>${line.separator}UPDATE `s8f7h_users` SET `s8f7h_users`.`requireReset` = 1
                                        WHERE `s8f7h_users`.`username` = 'admin';${line.separator}
                                    </message>
                                    <toFile>target/joomla-preconfigured/joomla.sql</toFile>
                                    <append>true</append>
                                </configuration>
                            </execution>
                            <execution>
                                <id>password-policy-user-registration</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>echo</goal>
                                </goals>
                                <configuration>
                                    <message>${line.separator}UPDATE `s8f7h_extensions` SET `s8f7h_extensions`.`params`
                                        =
                                        '{"allowUserRegistration":"0","new_usertype":"2","guest_usergroup":"9","sendpassword":"1","useractivation":"1","mail_to_admin":"0","captcha":"","frontend_userparams":"1","site_language":"0","change_login_name":"1","reset_count":"10","reset_time":"1","minimum_length":"8","minimum_integers":"0","minimum_symbols":"0","minimum_uppercase":"0","save_history":"1","history_limit":"5","mailSubjectPrefix":"","mailBodySuffix":""}'
                                        WHERE `s8f7h_extensions`.`name` = 'com_users' AND `s8f7h_extensions`.`type` =
                                        'component' AND `s8f7h_extensions`.`element` = 'com_users';${line.separator}
                                    </message>
                                    <toFile>target/joomla-preconfigured/joomla.sql</toFile>
                                    <append>true</append>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <!-- Copy all resources to the unpackaged preconfigured 
                        joomla - updatescripts.php, .htaccess, etc... -->
                    <plugin>
                        <artifactId>maven-resources-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy-htaccess</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${basedir}/target/joomla-preconfigured</outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>src/main/config/apache</directory>
                                            <filtering>true</filtering>
                                            <includes>
                                                <include>.htaccess</include>
                                            </includes>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                            <execution>
                                <id>copy-proxy</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${basedir}/target/joomla-preconfigured/proxy</outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>src/main/php/proxy</directory>
                                            <filtering>true</filtering>
                                            <includes>
                                                <include>.htaccess</include>
                                                <include>index.php</include>
                                            </includes>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                            <execution>
                                <id>copy-make-rhel</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${basedir}/target</outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>src/main/scripts/build</directory>
                                            <filtering>true</filtering>
                                            <includes>
                                                <include>make-rhel-package.sh</include>
                                            </includes>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <!-- Build the joomla RPM -->
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>rpm-maven-plugin</artifactId>
                        <version>2.1.3</version>
                        <executions>
                            <execution>
                                <id>generate-joomla-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <name>apiportal-joomla</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <!-- Note: Version, Summary, URL, Vendor, and 
                                        License are taken from the current project -->
                                    <mappings>
                                        <mapping>
                                            <directory>/tmp/axway-${project.version}/etc/apache2/conf.d</directory>
                                            <filemode>755</filemode>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <!-- Used for configuring Apache's 
                                                        mod_nss's SSL settings: protocols, cipher suites, etc.. -->
                                                    <location>src/main/config/apache/security.conf</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/tmp/axway-${project.version}/etc/apache2/vhosts.d</directory>
                                            <filemode>755</filemode>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <!-- Used for configuring Apache's 
                                                        ports, directories, etc.. -->
                                                    <location>src/main/config/apache/apiportal.conf</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/tmp/axway-${project.version}/etc/apache2</directory>
                                            <filemode>755</filemode>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <!-- Used for generating self-signed 
                                                        certificates. -->
                                                    <location>src/main/scripts/rpm/genssl.sh</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/tmp/axway-${project.version}/opt/axway/apiportal/htdoc
                                            </directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <sources>
                                                <source>
                                                    <!-- Joomla itself. -->
                                                    <location>target/joomla-preconfigured</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/tmp/axway-${project.version}/upgrade/joomla</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <sources>
                                                <source>
                                                    <location>target/joomla-upgrade</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/pre-install.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>
                                            target/${project.artifactId}-${project.version}/scripts/post-install.sh
                                        </scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                    <preremoveScriptlet>
                                        <scriptFile>src/main/scripts/rpm/pre-uninstall.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preremoveScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <!-- Build the API Portal RPM -->
                                <id>generate-apiportal-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <name>apiportal</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <!-- Note: Version, Summary, URL, Vendor, and 
                                        License are taken from the current project -->
                                    <requires>
                                        <require>apiportal-joomla</require>
                                        <require>apiportal-t3</require>
                                        <require>apiportal-purityiii</require>
                                        <require>apiportal-easyblog</require>
                                        <require>apiportal-easydiscuss</require>
                                        <require>apiportal-updatescript</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/axway/apiportal/htdoc/cli/updates</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <sources>
                                                <source>
                                                    <location>
                                                        target/${project.artifactId}${project.version}-${base.product.joomla.ext}-BN${product.build.number}.zip
                                                    </location>
                                                </source>
                                            </sources>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/post-install-updatescript.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <!-- Build T3 plugin RPM -->
                                <id>generate-t3-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <name>apiportal-t3</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <!-- Note: Version, Summary, URL, Vendor, and 
                                        License are taken from the current project -->
                                    <requires>
                                        <require>apiportal-joomla</require>
                                        <require>apiportal-updatescript</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/axway/apiportal/htdoc/cli/updates</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <dependency>
                                                <includes>
                                                    <include>com.joomlart:t3-system-plugin</include>
                                                </includes>
                                            </dependency>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/post-install-updatescript.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <!-- Build Purity III template RPM -->
                                <id>generate-purityIII-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <name>apiportal-purityiii</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <!-- Note: Version, Summary, URL, Vendor, and 
                                        License are taken from the current project -->
                                    <requires>
                                        <require>apiportal-joomla</require>
                                        <require>apiportal-t3</require>
                                        <require>apiportal-updatescript</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/axway/apiportal/htdoc/cli/updates</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <dependency>
                                                <includes>
                                                    <include>com.joomlart:purity-III-template</include>
                                                </includes>
                                            </dependency>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/post-install-updatescript.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <!-- Build AllVideos plugin RPM -->
                                <id>generate-allVideos-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <name>apiportal-allvideos</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <!-- Note: Version, Summary, URL, Vendor, and 
                                        License are taken from the current project -->
                                    <requires>
                                        <require>apiportal-joomla</require>
                                        <require>apiportal-updatescript</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/axway/apiportal/htdoc/cli/updates</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <dependency>
                                                <includes>
                                                    <include>net.joomla:plg_jw_allvideos</include>
                                                </includes>
                                            </dependency>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/post-install-updatescript.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <!-- Build EasyBlog plugin RPM -->
                                <id>generate-easyblog-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <name>apiportal-easyblog</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <!-- Note: Version, Summary, URL, Vendor, and 
                                        License are taken from the current project -->
                                    <requires>
                                        <require>apiportal-joomla</require>
                                        <require>apiportal-updatescript</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/axway/apiportal/htdoc/cli/updates</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <dependency>
                                                <includes>
                                                    <include>org.joomla:com_easyblog_pro</include>
                                                </includes>
                                            </dependency>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/post-install-updatescript.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <id>generate-easydiscuss-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <!-- Build EasyDiscuss plugin RPM -->
                                    <name>apiportal-easydiscuss</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <!-- Note: Version, Summary, URL, Vendor, and 
                                        License are taken from the current project -->
                                    <requires>
                                        <require>apiportal-joomla</require>
                                        <require>apiportal-updatescript</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/axway/apiportal/htdoc/cli/updates</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <dependency>
                                                <includes>
                                                    <include>
                                                        org.joomla:com_easydiscuss_pro
                                                    </include>
                                                </includes>
                                            </dependency>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/post-install-updatescript.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <id>generate-updatescript-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <!-- Build EasyDiscuss plugin RPM -->
                                    <name>apiportal-updatescript</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/axway/apiportal/htdoc/cli</directory>
                                            <filemode>755</filemode>
                                            <username>wwwrun</username>
                                            <groupname>www</groupname>
                                            <sources>
                                                <source>
                                                    <location>${project.basedir}/src/main/scripts/rpm/updatescript.php
                                                    </location>
                                                </source>
                                            </sources>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apacherestore.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <id>rhel-apache-conf-rpm</id>
                                <goals>
                                    <goal>rpm</goal>
                                </goals>
                                <configuration>
                                    <name>rhel-apache-conf</name>
                                    <group>Axway</group>
                                    <packager>Axway</packager>
                                    <needarch>x86_64</needarch>
                                    <!-- The rpm build release. By default is 1 -->
                                    <release>1</release>
                                    <requires>
                                        <require>httpd</require>
                                        <require>mod_ssl</require>
                                        <require>php > 5.3</require>
                                        <require>php-mysql</require>
                                        <require>php-gd</require>
                                        <require>php-mcrypt</require>
                                        <require>php-xml</require>
                                        <require>coreutils</require>
                                        <require>grep</require>
                                        <require>sed</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/etc/httpd/conf.d</directory>
                                            <filemode>755</filemode>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <location>src/main/config/apache/rhel/apiportal.conf</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/etc/httpd/conf.d</directory>
                                            <filemode>755</filemode>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <location>src/main/config/apache/rhel/security.conf</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/etc/httpd</directory>
                                            <filemode>755</filemode>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <location>src/main/config/apache/rhel/genssl.sh</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                    </mappings>
                                    <preinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apachestop.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </preinstallScriptlet>
                                    <postinstallScriptlet>
                                        <scriptFile>src/main/scripts/rpm/apacherestore.sh</scriptFile>
                                        <fileEncoding>utf-8</fileEncoding>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>build-helper-maven-plugin</artifactId>
                        <version>1.7</version>
                        <executions>
                            <execution>
                                <id>attach-artifacts</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>attach-artifact</goal>
                                </goals>
                                <configuration>
                                    <artifacts>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal-updatescript/RPMS/x86_64/apiportal-updatescript-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>updatescript-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal-purityiii/RPMS/x86_64/apiportal-purityiii-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>purityiii-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal-easydiscuss/RPMS/x86_64/apiportal-easydiscuss-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>easydiscuss-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal/RPMS/x86_64/apiportal-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>apiportal-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal-allvideos/RPMS/x86_64/apiportal-allvideos-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>allvideos-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal-joomla/RPMS/x86_64/apiportal-joomla-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>joomla-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal-t3/RPMS/x86_64/apiportal-t3-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>t3-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>
                                                ${project.build.directory}/rpm/apiportal-easyblog/RPMS/x86_64/apiportal-easyblog-${rpm.version}-1.x86_64.rpm
                                            </file>
                                            <classifier>easyblog-1.x86_64</classifier>
                                            <type>rpm</type>
                                        </artifact>
                                        <artifact>
                                            <file>${project.build.directory}/rhel7-install-package-${project.version}.tgz</file>
                                            <classifier>rhel7-install-package-${project.version}</classifier>
                                            <type>tgz</type>
                                        </artifact>
                                        <artifact>
                                            <file>${project.build.directory}/rhel7-upgrade-package-to-${project.version}.tgz
                                            </file>
                                            <classifier>rhel7-upgrade-package-to-${project.version}</classifier>
                                            <type>tgz</type>
                                        </artifact>
                                    </artifacts>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                </plugins>
            </build>
        </profile>
    </profiles>

</project>
